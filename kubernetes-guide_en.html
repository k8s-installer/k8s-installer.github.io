<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Kubernetes Installation Guide: ver 0.9.0</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Kubernetes Installation Guide: ver 0.9.0</h1>
<div id="toc" class="toc2">
<div id="toctitle">Index</div>
<ul class="sectlevel1">
<li><a href="#_revision_history">Revision history</a></li>
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_the_purpose_of_this_book">1.1. The purpose of this book</a></li>
<li><a href="#_glossary">1.2. Glossary</a></li>
</ul>
</li>
<li><a href="#_requirements">2. Requirements</a>
<ul class="sectlevel2">
<li><a href="#_system_configuration">2.1. System Configuration</a></li>
<li><a href="#_required_machine">2.2. Required machine</a>
<ul class="sectlevel3">
<li><a href="#_os">2.2.1. OS</a></li>
<li><a href="#_hardware_spec">2.2.2. Hardware spec</a></li>
<li><a href="#_network">2.2.3. Network</a></li>
<li><a href="#_other_requirements">2.2.4. Other requirements</a></li>
</ul>
</li>
<li><a href="#_load_balancer">2.3. Load balancer</a></li>
</ul>
</li>
<li><a href="#_kubernetes_installation_overview">3. Kubernetes Installation Overview</a>
<ul class="sectlevel2">
<li><a href="#_installation_instructions">3.1. Installation Instructions</a></li>
<li><a href="#_the_installers">3.2. The installers</a></li>
</ul>
</li>
<li><a href="#manual_install">4. Manual installation</a>
<ul class="sectlevel2">
<li><a href="#_common_proceure">4.1. Common proceure</a>
<ul class="sectlevel3">
<li><a href="#_proxy_configuration">4.1.1. Proxy configuration</a>
<ul class="sectlevel4">
<li><a href="#_yum">Yum</a></li>
<li><a href="#_docker">Docker</a></li>
</ul>
</li>
<li><a href="#_firewall">4.1.2. Firewall</a></li>
<li><a href="#_installing_the_docker_container_runtime">4.1.3. Installing the Docker Container Runtime</a></li>
<li><a href="#_disble_selinux">4.1.4. Disble SELinux</a></li>
<li><a href="#_disable_swap">4.1.5. Disable Swap</a></li>
<li><a href="#_change_sysconfig_configuration">4.1.6. Change sysconfig configuration</a></li>
<li><a href="#_insall_kubeadm_kubelet_kubectl">4.1.7. Insall kubeadm / kubelet / kubectl</a></li>
</ul>
</li>
<li><a href="#_installing_single_master_configuration">4.2. Installing single master configuration</a>
<ul class="sectlevel3">
<li><a href="#_master_node_installation">4.2.1. Master Node Installation</a></li>
<li><a href="#_network_add_on">4.2.2. Network add-on</a></li>
<li><a href="#_scheduling_settings">4.2.3. Scheduling Settings</a></li>
</ul>
</li>
<li><a href="#_join_worker_nodes">4.3. Join worker nodes</a></li>
</ul>
</li>
<li><a href="#script_installer">5. Script based installer</a>
<ul class="sectlevel2">
<li><a href="#_configuration">5.1. Configuration</a></li>
<li><a href="#_installing_docker_kubeadm">5.2. Installing Docker / kubeadm</a></li>
<li><a href="#_installing_master_node">5.3. Installing master node</a></li>
<li><a href="#_ha_configuration_installing_the_rest_of_the_master_node">5.4. HA configuration: Installing the rest of the master node</a></li>
<li><a href="#_installing_worker_nodes">5.5. Installing worker nodes.</a></li>
<li><a href="#_confirmation_after_installation">5.6. Confirmation after installation</a></li>
</ul>
</li>
<li><a href="#ansible_installer">6. Ansible Installer</a>
<ul class="sectlevel2">
<li><a href="#_specifications">6.1. Specifications</a></li>
<li><a href="#_requirements_2">6.2. Requirements</a>
<ul class="sectlevel3">
<li><a href="#_instructions_for_setting_up_ssh_public_key_authentication">6.2.1. Instructions for setting up ssh public key authentication</a></li>
<li><a href="#_ssh_agent">6.2.2. ssh-agent</a></li>
<li><a href="#_ansible_installation_instructions">6.2.3. Ansible installation instructions</a></li>
</ul>
</li>
<li><a href="#_configuration_2">6.3. Configuration</a>
<ul class="sectlevel3">
<li><a href="#_inventory_file">6.3.1. Inventory file</a></li>
<li><a href="#_define_variables">6.3.2. Define variables</a></li>
</ul>
</li>
<li><a href="#_install">6.4. Install</a>
<ul class="sectlevel3">
<li><a href="#_common_procedure">6.4.1. common procedure</a></li>
<li><a href="#_deploying_kubernetes_to_the_first_master_node">6.4.2. Deploying Kubernetes to the first master node</a></li>
<li><a href="#_deploy_to_the_second_and_subsequent_master_nodes">6.4.3. Deploy to the second and subsequent master nodes</a></li>
<li><a href="#_deploy_to_the_worker_nodes">6.4.4. Deploy to the worker nodes</a></li>
<li><a href="#_deploy_network_storage_and_applications">6.4.5. Deploy network, storage, and applications</a></li>
</ul>
</li>
<li><a href="#_operation_check">6.5. Operation check</a></li>
</ul>
</li>
<li><a href="#networking">7. Networking</a>
<ul class="sectlevel2">
<li><a href="#_firewall_2">7.1. Firewall</a></li>
<li><a href="#_metallb">7.2. MetalLB</a></li>
</ul>
</li>
<li><a href="#storage">8. Storage</a>
<ul class="sectlevel2">
<li><a href="#_overview">8.1. Overview</a></li>
<li><a href="#rook_nfs">8.2. Rook / NFS</a>
<ul class="sectlevel3">
<li><a href="#_configuration_and_deployment">8.2.1. Configuration and Deployment</a></li>
<li><a href="#_storage_class">8.2.2. Storage class</a></li>
</ul>
</li>
<li><a href="#rook_ceph">8.3. Rook / Ceph</a>
<ul class="sectlevel3">
<li><a href="#_requirements_3">8.3.1. Requirements.</a></li>
<li><a href="#_configuration_and_deployment_2">8.3.2. Configuration and Deployment</a></li>
<li><a href="#_storage_class_2">8.3.3. Storage class</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_application">9. Application</a>
<ul class="sectlevel2">
<li><a href="#private_registry">9.1. Private Registry</a>
<ul class="sectlevel3">
<li><a href="#_configuration_and_deployment_3">9.1.1. Configuration and Deployment</a></li>
<li><a href="#_using_private_registry">9.1.2. Using private registry</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#offline_install">10. Offline Installation</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">10.1. Overview</a></li>
<li><a href="#_generating_an_offline_installation_file">10.2. Generating an offline installation file</a>
<ul class="sectlevel3">
<li><a href="#_requirements_4">10.2.1. Requirements</a></li>
<li><a href="#_preparation">10.2.2. Preparation</a></li>
<li><a href="#_proxy_configuration_2">10.2.3. Proxy configuration</a>
<ul class="sectlevel4">
<li><a href="#_yum_2">yum</a></li>
<li><a href="#_docker_2">Docker</a></li>
</ul>
</li>
<li><a href="#_generating_an_offline_installation_file_2">10.2.4. Generating an offline installation file</a></li>
</ul>
</li>
<li><a href="#_use_with_script_based_installer">10.3. Use with script based installer</a></li>
<li><a href="#_ansible_installer">10.4. Ansible installer</a></li>
</ul>
</li>
<li><a href="#_upgrading_cluster">11. Upgrading cluster</a>
<ul class="sectlevel2">
<li><a href="#_notes">11.1. Notes</a></li>
<li><a href="#_ansible_installer_2">11.2. Ansible installer</a>
<ul class="sectlevel3">
<li><a href="#_prepare_for_offline_installation">11.2.1. Prepare for offline installation</a></li>
<li><a href="#_set_up_version">11.2.2. Set up version</a></li>
<li><a href="#_performing_upgrades">11.2.3. Performing Upgrades</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_operations">12. Operations</a>
<ul class="sectlevel2">
<li><a href="#_renewal_of_certificates">12.1. Renewal of certificates</a>
<ul class="sectlevel3">
<li><a href="#_automatic_renewal_of_certificates">12.1.1. Automatic renewal of certificates</a></li>
<li><a href="#_verification_of_certificate_expiration_date">12.1.2. Verification of Certificate Expiration Date</a></li>
<li><a href="#_manual_certificate_update">12.1.3. Manual certificate update</a>
<ul class="sectlevel4">
<li><a href="#_if_you_are_using_the_ansible_installer">If you are using the Ansible installer</a></li>
<li><a href="#_if_you_are_using_the_script_based_installer">If you are using the script based installer</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_revision_history">Revision history</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO:</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_purpose_of_this_book">1.1. The purpose of this book</h3>
<div class="paragraph">
<p>This document describes how to install and use Kubernetes in an on-premises environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="_glossary">1.2. Glossary</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Term</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Master Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The master node of Kubernetes.
 A master servers of Kubernetes (kube-apiserver, kube-controller-manager, kube-scheduler, etcd) run on this node.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A worker node of Kubernetes. A node to run workloads.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High Availability. 3 master nodes are required for HA cluster.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requirements">2. Requirements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_system_configuration">2.1. System Configuration</h3>
<div class="paragraph">
<p>There are three system configurations for installing Kubernetes.
The number of machines required will vary depending on the configuration.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Standalone: a configuration with only one machine.</p>
<div class="ulist">
<ul>
<li>
<p>Use only one machine and install both Kubernetes master and worker on the machine.</p>
</li>
<li>
<p>The workload will also run on the same machine.</p>
</li>
<li>
<p>Recommended for use in development environments and for verification and demonstration purposes only.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Single Master: one master and one or more workers</p>
<div class="ulist">
<ul>
<li>
<p>A single master can be configured with multiple workers.</p>
</li>
<li>
<p>The workload runs on the workers.</p>
</li>
<li>
<p>The master node will be a SPOF and is not recommended for use in a production environment.</p>
</li>
</ul>
</div>
</li>
<li>
<p>HA configuration: 3 masters and 1 or more workers.</p>
<div class="ulist">
<ul>
<li>
<p>HA is configured with three masters.</p>
</li>
<li>
<p>L4 load balancer is required separately because it is necessary to distribute the load to the kube-apiserver running on the master.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To create an HA configuration, you need at least three machines as master nodes.
In addition, you need at least one worker node, and at least three recommended.
The number of worker nodes depends on the amount of workloads to be executed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_required_machine">2.2. Required machine</h3>
<div class="paragraph">
<p>This section describes each of the machines that make up Kubernetes.</p>
</div>
<div class="paragraph">
<p>The following requirements are almost same as described in
<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Installing kubeadm</a>.</p>
</div>
<div class="sect3">
<h4 id="_os">2.2.1. OS</h4>
<div class="paragraph">
<p>Machines with one of the following operating systems installed is required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RedHat Enterprise Linux (RHEL) 7 (7.7 or later), 8</p>
<div class="ulist">
<ul>
<li>
<p>You must have completed registration of your RedHat subscription using <code>subscription-manager</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>CentOS 7 (7.7 or later), 8</p>
</li>
<li>
<p>Ubuntu 18.04, 20.04</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only the ansible installer is supported for RHEL8 / CentOS8 / Ubuntu.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You can&#8217;t use firewalld for RHEL8 / CentOS8.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_hardware_spec">2.2.2. Hardware spec</h4>
<div class="paragraph">
<p>The machine specs require the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>2 GB or more of RAM per machine</p>
<div class="ulist">
<ul>
<li>
<p>any less will leave little room for your apps)</p>
</li>
</ul>
</div>
</li>
<li>
<p>2 CPUs or more</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_network">2.2.3. Network</h4>
<div class="paragraph">
<p>For the network, the following requirements are required</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Full network connectivity between all machines in the cluster</p>
<div class="ulist">
<ul>
<li>
<p>public or private network is fine</p>
</li>
</ul>
</div>
</li>
<li>
<p>Internet connectivity</p>
<div class="ulist">
<ul>
<li>
<p>A connection through a proxy server is fine.</p>
</li>
<li>
<p>For offline installation, no Internet connection is required. However, the default route must still be configured.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_other_requirements">2.2.4. Other requirements</h4>
<div class="ulist">
<ul>
<li>
<p>Unique hostname, MAC address, and product_uuid for every node.</p>
<div class="ulist">
<ul>
<li>
<p>The hostname can be checked with the <code>hostname</code> command.</p>
</li>
<li>
<p>You can get the MAC address of the network interfaces using the command <code>ip link</code> or <code>ifconfig -a</code>.</p>
</li>
<li>
<p>The product_uuid can be checked by using the command <code>sudo cat /sys/class/dmi/id/product_uuid</code>.</p>
</li>
<li>
<p>For more information, See "Verify the MAC address and product_uuid are unique for every node" section in
<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Installing kubeadm</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Certain ports are open on your machines. See here for more details.</p>
<div class="ulist">
<ul>
<li>
<p>For more information on the ports to be opened, see "Check required ports" section of
<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Installing kubeadm</a>.</p>
</li>
<li>
<p>If you use the installer, the firewall is automatically configured.</p>
</li>
<li>
<p>If you use the installer, it will automatically configure the firewall for you.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Swap disabled.</p>
<div class="ulist">
<ul>
<li>
<p>You MUST disable swap in order for the kubelet to work properly.</p>
</li>
<li>
<p>If you use an installer, Swap is automatically turned off.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_load_balancer">2.3. Load balancer</h3>
<div class="paragraph">
<p>When configuring HA configuration, an L4(TCP) level load balancer is required.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The load balancer must have a DNS-resolvable FQDN name.</p>
</li>
<li>
<p>Load balancing at the L4 level</p>
<div class="ulist">
<ul>
<li>
<p>Load balancing TCP port 6443 to same ports of the master node (three nodes).</p>
</li>
<li>
<p>Perform health checks on TCP connections.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kubernetes_installation_overview">3. Kubernetes Installation Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation_instructions">3.1. Installation Instructions</h3>
<div class="paragraph">
<p>There are three different installation procedures. We recommend using the Ansible installer.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Manual Installation: Manual installation using <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">kubeadm</a></p>
<div class="ulist">
<ul>
<li>
<p>These instructions are provided as a reference only. Normally, you can use the <code>k8s-installer</code> installer to perform an automated installation using</p>
</li>
<li>
<p>Please see <a href="#manual_install">Chapter 4, <em>Manual installation</em></a> for details.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Script Installer: Automatic installation using the sh script-based installer</p>
<div class="ulist">
<ul>
<li>
<p>Standalone and single-master configurations are supported.</p>
</li>
<li>
<p>This installer is a simplified version and only sets up the Kubernetes cluster (no applications are installed).</p>
</li>
<li>
<p>See <a href="#script_installer">Chapter 5, <em>Script based installer</em></a> for details.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ansible installer.</p>
<div class="ulist">
<ul>
<li>
<p>Automatic cluster batch installation using Ansible.</p>
</li>
<li>
<p>Deploys networking, storage, and applications as well as Kubernetes.</p>
</li>
<li>
<p>See <a href="#ansible_installer">Chapter 6, <em>Ansible Installer</em></a> for more information.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The script installer and Ansible installer also supports offline installation.
In offline installation, all the files required for the installation are obtained on a machine connected to the Internet,
and then transferred to the target machines using a USB memory stick or hard disk.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only the ansible installer is suppported for RHEL8 / CentOS8 / Ubuntu.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_installers">3.2. The installers</h3>
<div class="paragraph">
<p>The scrip installer and ansible installer is included with <a href="https://github.com/k8s-installer/k8s-installer">k8s-installer</a>.</p>
</div>
<div class="paragraph">
<p>You can download them from <a href="https://github.com/k8s-installer/k8s-installer/releases" class="bare">https://github.com/k8s-installer/k8s-installer/releases</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="manual_install">4. Manual installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the steps to install Kubernetes manually.</p>
</div>
<div class="paragraph">
<p>The procedures of this chapter are base on <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Installing kubeadm</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This procedure is only supported on RHEL7 / CentOS7.
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">The Ansible installer is recommended</div>
<div class="paragraph">
<p>Manual installation instructions are shown <strong>for reference only</strong>.</p>
</div>
<div class="paragraph">
<p>Normally, you should use an installer (recommended by the Ansible installer) to perform an automated installation.
The installer is designed to automatically perform the steps shown here.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_common_proceure">4.1. Common proceure</h3>
<div class="paragraph">
<p>This section describes the common steps that must be performed prior to installing Kubernetes.
This procedure must be performed on all machines, no matter which configuration you use.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All of these steps must be performed with root privileges. Execute <code>sudo -i</code> and then execute it.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_proxy_configuration">4.1.1. Proxy configuration</h4>
<div class="paragraph">
<p>If you need to connect to the Internet via a proxy server, you need to do the following.</p>
</div>
<div class="sect4">
<h5 id="_yum">4.1.1.1. Yum</h5>
<div class="paragraph">
<p>Add following line to <code>/etc/yum.conf</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>proxy={PROXY_URL}</pre>
</div>
</div>
<div class="paragraph">
<p>Set proxy server URL to {PROXY_URL} in <code>http://[proxy_hostname]:[proxy_port]</code> format.</p>
</div>
</div>
<div class="sect4">
<h5 id="_docker">4.1.1.2. Docker</h5>
<div class="paragraph">
<p>Create <code>/etc/systemd/system/docker.service.d/http-proxy.conf</code> file as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mkdir -p /etc/systemd/system/docker.service.d

cat &lt;&lt;EOF &gt; /etc/systemd/system/docker.service.d/http-proxy.conf
[Service]
Environment="HTTP_PROXY={PROXY_URL}" "HTTPS_PROXY={PROXY_URL}" "NO_PROXY=127.0.0.1,localhost"
EOF</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_firewall">4.1.2. Firewall</h4>
<div class="paragraph">
<p>You must disable the firewall, or open all of the Inbound TCP ports listed below.
For more information on the ports to be opened, see <a href="https://kubernetes.io/ja/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Check required ports</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Master nodes</p>
<div class="ulist">
<ul>
<li>
<p>6443</p>
</li>
<li>
<p>2379-2380</p>
</li>
<li>
<p>10250-10252</p>
</li>
</ul>
</div>
</li>
<li>
<p>Worker nodes</p>
<div class="ulist">
<ul>
<li>
<p>10250</p>
</li>
<li>
<p>30000-32767</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The steps to open ports are as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># for master node
firewall-cmd --add-port=6443/tcp --permanent
firewall-cmd --add-port=2379-2380/tcp --permanent
firewall-cmd --add-port=10250-10252/tcp --permanent
firewall-cmd --reload

# for worker-node
firewall-cmd --add-port=10250tcp --permanent
firewall-cmd --add-port=30000-32767/tcp --permanent
firewall-cmd --reload</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_installing_the_docker_container_runtime">4.1.3. Installing the Docker Container Runtime</h4>
<div class="paragraph">
<p>Use the RHEL7/CentOS7 standard Docker as the container runtime.</p>
</div>
<div class="paragraph">
<p>For RHEL7, enable the rhel-7-server-extra-rpms repository.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>subscription-manager repos --enable=rhel-7-server-extras-rpms</pre>
</div>
</div>
<div class="paragraph">
<p>Follow the steps below to install and start the docker.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>yum install -y docker
systemctl enable --now docker</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_disble_selinux">4.1.4. Disble SELinux</h4>
<div class="paragraph">
<p>Disable SELinux</p>
</div>
<div class="literalblock">
<div class="content">
<pre>setenforce 0
sed -i 's/^SELINUX=enforcing$/SELINUX=disabled/' /etc/selinux/config</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_disable_swap">4.1.5. Disable Swap</h4>
<div class="paragraph">
<p>If Swap is not disabled, disable it.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo swapoff -a</pre>
</div>
</div>
<div class="paragraph">
<p>Also, check <code>/etc/fstab</code> and disable the swap setting.
Here&#8217;s an example.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sed -i 's/^\([^#].* swap .*\)$/#\1/' /etc/fstab</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_change_sysconfig_configuration">4.1.6. Change sysconfig configuration</h4>
<div class="paragraph">
<p>Modify sysctl settings to enable bridge the network.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl --system</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_insall_kubeadm_kubelet_kubectl">4.1.7. Insall kubeadm / kubelet / kubectl</h4>
<div class="paragraph">
<p>Install kubeadm / kubelet / kubectl and start kubelet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF

yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes

systemctl enable --now kubelet</pre>
</div>
</div>
<div class="paragraph">
<p>Lock version of the kubeadm / kubelet / kubectl to avoid upgrading.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>yum install yum-plugin-versionlock
yum versionlock add kubeadm kubelet kubectl</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_single_master_configuration">4.2. Installing single master configuration</h3>
<div class="paragraph">
<p>Here are the installation steps for a single master configuration.</p>
</div>
<div class="sect3">
<h4 id="_master_node_installation">4.2.1. Master Node Installation</h4>
<div class="paragraph">
<p>Install the Kubernetes control plane on the master node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo kubeadm init --pod-network-cidr=192.168.0.0/16</pre>
</div>
</div>
<div class="paragraph">
<p>The network address (CIDR) for the pod is 192.168.0.0/16.
If there is a conflict with your current address, you may need to change it accordingly.</p>
</div>
<div class="paragraph">
<p>The installation takes a few minutes. You should see a log on your screen that looks like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
[bootstraptoken] creating the "cluster-info" ConfigMap in the "kube-public" namespace
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

You should now deploy a Pod network to the cluster.
Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
  /docs/concepts/cluster-administration/addons/

You can now join any number of machines by running the following on each node
as root:

  kubeadm join &lt;control-plane-host&gt;:&lt;control-plane-port&gt; --token &lt;token&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The message <code>kubadm join&#8230;&#8203;' shown at the end of the above should be saved (to file etc).
The `kubeadm join&#8230;&#8203;</code> procedure is necessary for worker nodes to join the Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>Follow the above instructions to create ~/.kube/config.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config</pre>
</div>
</div>
<div class="paragraph">
<p>Make sure you can connect to your Kubernetes cluster successfully by following these steps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kubectl cluster-info</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_network_add_on">4.2.2. Network add-on</h4>
<div class="paragraph">
<p>Install the Pod Network Add-on. This procedure uses <a href="https://www.projectcalico.org/">Calico</a>.</p>
</div>
<div class="paragraph">
<p>Please install Calico by following the steps below.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl apply -f https://docs.projectcalico.org/v3.8/manifests/calico.yaml</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_scheduling_settings">4.2.3. Scheduling Settings</h4>
<div class="paragraph">
<p>Change the master node to be schedulable only in a standalone configuration.
Failure to do so prevents workloads from running on the master node.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl taint nodes --all node-role.kubernetes.io/master:NoSchedule-</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_join_worker_nodes">4.3. Join worker nodes</h3>
<div class="paragraph">
<p>Join the worker nodes to your Kubernetes cluster by doing the following on each worker node.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubeadm join --token &lt;token&gt; &lt;control-plane-host&gt;:&lt;control-plane-port&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The argument for <code>kubeadm join</code> should be the one shown on the master node installation.</p>
</div>
<div class="paragraph">
<p>If you forget the contents of the <code>kubeadm join</code> or the token has become invalid after 24 hours,
you can regenerate the token and perform the following steps on the master node.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubeadm token create --print-join-command</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="script_installer">5. Script based installer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document explains how to install using the script based installer.
The script installer is located in the <code>script</code> directory of the <code>k8s-installer</code>.</p>
</div>
<div class="paragraph">
<p>If you use the script installer, you will need to deploy the installer on each machine and perform the installation on each machine.</p>
</div>
<div class="sect2">
<h3 id="_configuration">5.1. Configuration</h3>
<div class="paragraph">
<p>Copy <code>config.sample.sh</code> to <code>config.sh</code> and configure.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In case of HA configuration:</p>
<div class="ulist">
<ul>
<li>
<p>Set DNS name (FQDN) and port number of the load balancer to <code>LOAD_BALANCER_DNS</code> and <code>LOAD_BALANCER_PORT</code>.</p>
</li>
<li>
<p>The load balancer should be configured to load-balance L4 to all master nodes on the specified ports.</p>
</li>
<li>
<p>For more information, see <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/">Creating Highly Available clusters with kubeadm</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If your Internet connection needs to go through a proxy, set the values of <code>PROXY_URL</code> and <code>NO_PROXY</code>.</p>
<div class="ulist">
<ul>
<li>
<p>NO_PROXY must have the IP address or DNS name of kube-apiserver.
Specify the value of the master node in the case of a single host configuration, or the value of the load balancer in the case of HA configuration.
If this is not properly configured, the master node installation will fail.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you want to do an offline installation, set <code>OFFLINE_INSTALL</code> to <code>yes</code>. Details are discussed later.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_installing_docker_kubeadm">5.2. Installing Docker / kubeadm</h3>
<div class="paragraph">
<p>Install Docker, kubeadm and others.</p>
</div>
<div class="paragraph">
<p>This procedure must be done on all master and worker nodes.</p>
</div>
<div class="paragraph">
<p>Log in as a regular user with possible to use sudo (no direct root login).
Follow these steps to perform the installation:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sudo ./install-common.sh</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_master_node">5.3. Installing master node</h3>
<div class="paragraph">
<p>Install Kubernetes master control plane on master node.</p>
</div>
<div class="paragraph">
<p>Log in to the master node (the first master node in the HA configuration) and perform the following procedures.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># For single master configuration
$ sudo ./install-master-single.sh</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># For HA configuration (the first master node)
$ sudo ./install-master-ha.sh</pre>
</div>
</div>
<div class="paragraph">
<p>The installation takes a few minutes.
Please take note that you will see a <code>kubeadm join</code> command line on the screen to join worker nodes.</p>
</div>
<div class="paragraph">
<p>Once the installation is complete, follow these steps to install ~/.kube/config</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ./install-kubeconfig.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Execute <code>kubectl cluster-info</code> and verify that the control plane is operating normally.</p>
</div>
<div class="paragraph">
<p>Finally, install the calico network add-on.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ./install-cni.sh</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ha_configuration_installing_the_rest_of_the_master_node">5.4. HA configuration: Installing the rest of the master node</h3>
<div class="paragraph">
<p>See "Steps for the rest of the control plane nodes" section of
<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/">Creating Highly Available clusters with kubeadm</a>
for installation instructions for the second and subsequent master nodes in an HA configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_worker_nodes">5.5. Installing worker nodes.</h3>
<div class="paragraph">
<p>Login to each worker node and execute the above obtained <code>kubeadm join</code> command with sudo to join the node to the Kubernetes cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_confirmation_after_installation">5.6. Confirmation after installation</h3>
<div class="paragraph">
<p>Run <code>kubectl get nodes</code> on the master node to make sure that all nodes are added and ready.</p>
</div>
<div class="paragraph">
<p>Also, run <code>kubectl get all -n kube-system</code> on the master node and make sure that all the pods are running normally.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ansible_installer">6. Ansible Installer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following are the steps to install using the Ansible based installer.</p>
</div>
<div class="paragraph">
<p>When using the Ansible installer, the installation process is carried out on any machine where Ansible is installed.
We will refer to this machine as "the Ansible node".</p>
</div>
<div class="paragraph">
<p>You can use any one of the master or the worker node as an Ansible node.</p>
</div>
<div class="paragraph">
<p>This install procedure should be done in the <code>ansible</code> directory of <code>k8s-installer</code>.</p>
</div>
<div class="sect2">
<h3 id="_specifications">6.1. Specifications</h3>
<div class="paragraph">
<p>The specifications for the Kubernetes cluster deployed by the Ansible installer are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The following settings are made on all nodes.</p>
<div class="ulist">
<ul>
<li>
<p>Swap is disabled.</p>
</li>
<li>
<p>SELinux is disabled.</p>
</li>
<li>
<p>Firewall is off by default (optionally set to on)</p>
</li>
<li>
<p>The sysctl settings are changed.</p>
</li>
<li>
<p>The container runtime is installed.</p>
<div class="ulist">
<ul>
<li>
<p>Docker or containerd is installed, depending on the configuration. The default is Docker (but for RHEL8/CentOS8, only contained will be used)</p>
</li>
</ul>
</div>
</li>
<li>
<p>The following packages are installed:</p>
<div class="ulist">
<ul>
<li>
<p>kubeadm, kubectl, cfssl, libselinux-python, lvm2, gnupg2, nfs-utils and nfs-common</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The Kubernetes cluster is deployed using kubeadm.</p>
<div class="ulist">
<ul>
<li>
<p>The CA certificate expires in 30 years (kubeadm default is 10 years).</p>
</li>
<li>
<p>The master node will be set to Schedulable (optionally set to NoSchedule)</p>
</li>
</ul>
</div>
</li>
<li>
<p>The ~/.kube/config file is installed on the master nodes.</p>
</li>
<li>
<p>The Calico network plugin will be deployed</p>
</li>
<li>
<p>The following is deployed on the Kubernetes cluster, except for the ones marked with (*) will not be deployed by default.</p>
<div class="ulist">
<ul>
<li>
<p>Nginx ingress controller</p>
</li>
<li>
<p>MetalLB (*)</p>
</li>
<li>
<p>rook-nfs (*)</p>
</li>
<li>
<p>rook-ceph (*)</p>
</li>
<li>
<p>storageclass default configuration (*)</p>
</li>
<li>
<p>metrics-server</p>
</li>
<li>
<p>docker registry (*)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer the
<a href="https://github.com/k8s-installer/k8s-installer/blob/develop/ansible/design/sequence.md">k8s-installer sequence</a>
for the entire install sequence.</p>
</div>
</div>
<div class="sect2">
<h3 id="_requirements_2">6.2. Requirements</h3>
<div class="paragraph">
<p>Ansible 2.9 or higher must be installed on the Ansible node.</p>
</div>
<div class="paragraph">
<p>You need to be able to log in via ssh from the Ansible node to all master and worker nodes.
In this case, the following conditions are required.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must be able to make an ssh connection from the Ansible node to each node with public key authentication.</p>
<div class="ulist">
<ul>
<li>
<p>Do not use root as the login user.</p>
</li>
<li>
<p>It is recommended that the login user name be the same on all machines.</p>
</li>
<li>
<p>Password authentication cannot be used. Use only public key authentication.</p>
</li>
</ul>
</div>
</li>
<li>
<p>No passphare input is required when perform public key authentication.</p>
<div class="ulist">
<ul>
<li>
<p>If you have a passphrase set, you must use ssh-agent.</p>
</li>
</ul>
</div>
</li>
<li>
<p>You must be able to run sudo as the logged-in user after you ssh login to each node from the Ansible node.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_instructions_for_setting_up_ssh_public_key_authentication">6.2.1. Instructions for setting up ssh public key authentication</h4>
<div class="paragraph">
<p>If you don&#8217;t already have an ssh key pair on the Ansible node, follow these steps to create it.
~/.ssh/id_rsa, ~/.ssh/id_rsa.pub will be generated.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ssh-keygen</pre>
</div>
</div>
<div class="paragraph">
<p>On the Ansible node, perform the following steps for each master/worker node to enable login with public key authentication.
The public key will be added to ~/.ssh/authorized_keys on each node.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ssh-copy-id [hostname]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ssh_agent">6.2.2. ssh-agent</h4>
<div class="paragraph">
<p>If you set a passphrase for your ssh key (and you should for security reasons),
you should use ssh-agent to be able to login using ssh without passphrase.</p>
</div>
<div class="paragraph">
<p>There are a number of ways to start ssh-agent, but the easiest way is to run the following on the Ansible node:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ exec ssh-agent $SHELL</pre>
</div>
</div>
<div class="paragraph">
<p>Set your passphrase to ssh-agent as follows.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ssh-add</pre>
</div>
</div>
<div class="paragraph">
<p>Logging out will cause ssh-agent to exit, so this procedure must be performed each time you log in to the Ansible node.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ansible_installation_instructions">6.2.3. Ansible installation instructions</h4>
<div class="paragraph">
<p>Create a Python virtual environment on an Ansible node.
Use Python 2 + <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a>
or Python 3 + <a href="https://docs" class="bare">https://docs</a>. python.org/en/3/library/venv.html[venv].</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of how to create a virtual environment in the case of Python2 + virtualenv:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sudo yum install python-virtualenv
$ virtualenv $HOME/venv</pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of how to create a virtual environment for Python 3 + venv:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sudo subscription-manager repos --enable rhel-7-server-optional-rpms  # RHEL7
$ sudo yum install python3 python3-pip gcc openssl-devel python3-devel
$ python3 -m venv $HOME/venv</pre>
</div>
</div>
<div class="paragraph">
<p>Activate the virtual environment as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ . $HOME/venv/bin/activate</pre>
</div>
</div>
<div class="paragraph">
<p>Follow the steps below to install Ansible.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ pip install -U -r requirements.txt</pre>
</div>
</div>
<div class="paragraph">
<p>If you need to install Ansible on an Ansible machine in an offline environment, use
<a href="https://github.com/tmurakam/python-offline-env">python-offline-env</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_2">6.3. Configuration</h3>
<div class="paragraph">
<p>Log in to the Ansible node as a working user.
Extract the installer and perform the following tasks.</p>
</div>
<div class="sect3">
<h4 id="_inventory_file">6.3.1. Inventory file</h4>
<div class="paragraph">
<p>Copy the <code>sample/hosts</code> file to the <code>inventory/hosts</code> file and set the information of the node to be installed.</p>
</div>
<div class="paragraph">
<p>There are three groups, please define the machine in the appropriate group.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>master_first: Specify the first master node.</p>
</li>
<li>
<p>master_secondary: Specify the second or later master nodes in case of HA configuration.</p>
</li>
<li>
<p>worker: Specify the worker nodes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For single master configuration, set only master_first and worke. (leave master_secondary empty)</p>
</div>
<div class="paragraph">
<p>In the HA configuration, you need at least three odd-numbered master nodes.
Specify the first one as master_first and the rest as master_secondary.</p>
</div>
<div class="paragraph">
<p>Here is an example of how to specify the machine:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>master1 ansible_user=johndoe ansible_host=10.0.1.10 ip=10.0.1.10</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>hostname: Specify the hostname at the beginning. The hostname is the Kubernetes node name as it is.</p>
</li>
<li>
<p>ansible_user: Specify the username on the target node to be used for ssh login.</p>
<div class="ulist">
<ul>
<li>
<p>You can omit this if it is the same username as the user on the Ansible node.</p>
</li>
</ul>
</div>
</li>
<li>
<p>ansible_host: The hostname or IP address to use when connecting with ssh.</p>
<div class="ulist">
<ul>
<li>
<p>If it is the same as the host name, it can be omitted.</p>
</li>
</ul>
</div>
</li>
<li>
<p>ip: Specify the IP address of the node.</p>
<div class="ulist">
<ul>
<li>
<p>Specify an IP address that can communicate directly with other nodes in the cluster. This is the advertized IP address of the kube-apiserver and kubelet.</p>
</li>
<li>
<p>If omitted, the IP address of the interface specified as the default gateway for the remote machine will be used.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_define_variables">6.3.2. Define variables</h4>
<div class="paragraph">
<p>Copy <code>sample/group_vars/all/*.yml</code> files to <code>inventory/group_vars/all/</code> directory and edit as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>main.yml</p>
<div class="ulist">
<ul>
<li>
<p>lb_apiserver_address: In case of HA configuration, set the FQDN name or IP address of the load balancer.</p>
</li>
<li>
<p>pod_subnet: Speccify Pod subnet (CIDR). Normally, no changes are required, but if the IP address conflicts with an existing address, you need to change it.</p>
</li>
</ul>
</div>
</li>
<li>
<p>offline.yml</p>
<div class="ulist">
<ul>
<li>
<p>offline_install: Set to <code>yes</code> If you want to do an offline installation. See <a href="#offline_install">Chapter 10, <em>Offline Installation</em></a> for details of the offline installation procedure.</p>
</li>
</ul>
</div>
</li>
<li>
<p>proxy.yml</p>
<div class="ulist">
<ul>
<li>
<p>If your Internet connection needs to go through a proxy, set the <code>proxy_url</code> and <code>proxy_noproxy</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>version.yml</p>
<div class="ulist">
<ul>
<li>
<p>Specify the version of Kubernetes to install. If not specified, the default value of <code>k8s-installer</code> is used.</p>
</li>
</ul>
</div>
</li>
<li>
<p>networking.yml</p>
<div class="ulist">
<ul>
<li>
<p>Configure the network settings. See <a href="#networking">Chapter 7, <em>Networking</em></a> for details.</p>
</li>
</ul>
</div>
</li>
<li>
<p>storage.yml</p>
<div class="ulist">
<ul>
<li>
<p>Configure the storage settings. See <a href="#storage">Chapter 8, <em>Storage</em></a> for details.</p>
</li>
</ul>
</div>
</li>
<li>
<p>registry.yml</p>
<div class="ulist">
<ul>
<li>
<p>Configure the private registry settings. See <a href="#private_registry">Section 9.1, &#8220;Private Registry&#8221;</a> for details.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use a proxy, you must specify the IP address or DNS name of the kube-apiserver in <code>proxy_noproxy</code>.
Specify the value of the master node in the case of a single host configuration, or the value of the load balancer in the case of HA configuration.</p>
</div>
<div class="paragraph">
<p>If this is not set properly, the master node installation will fail.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install">6.4. Install</h3>
<div class="sect3">
<h4 id="_common_procedure">6.4.1. common procedure</h4>
<div class="paragraph">
<p>Perform the following steps to common pre-process for all nodes.
This procedure involves offline repository configuration, proxy configuration, installation of necessary packages (including Docker/kubeadm) and
common configuration process, etc.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts common.yml -K</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t need a <code>sudo</code> password on the machine you are logging into, you can omit the -K (--ask-become-pass) option.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_deploying_kubernetes_to_the_first_master_node">6.4.2. Deploying Kubernetes to the first master node</h4>
<div class="paragraph">
<p>Install the Kubernetes on the first master node by doing the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts master-first.yml -K</pre>
</div>
</div>
<div class="paragraph">
<p>At this point, Kubernetes will be running as a single node configuration.
You can verify that some pods are running by logging in to the host and running <code>kubectl get all --all-namespaces</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploy_to_the_second_and_subsequent_master_nodes">6.4.3. Deploy to the second and subsequent master nodes</h4>
<div class="paragraph">
<p>Join the second and subsequent master nodes to the Kubernetes cluster by doing the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts master-secondary.yml -K</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deploy_to_the_worker_nodes">6.4.4. Deploy to the worker nodes</h4>
<div class="paragraph">
<p>Join all worker nodes to the Kubernetes cluster by doing the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts worker.yml -K</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deploy_network_storage_and_applications">6.4.5. Deploy network, storage, and applications</h4>
<div class="paragraph">
<p>Deploy the network, storage, and applications by doing the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts networking.yml -K
$ ansible-playbook -i inventory/hosts storage.yml -K
$ ansible-playbook -i inventory/hosts apps.yml -K</pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">How to do all steps at once</div>
<div class="paragraph">
<p>You can also perform all of the above steps at once by following the steps below.
However, it is usually recommended that you go through them step by step.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts site.yml -K</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operation_check">6.5. Operation check</h3>
<div class="paragraph">
<p>Run <code>kubectl get nodes</code> on the master node to make sure that all nodes are added and ready.</p>
</div>
<div class="paragraph">
<p>Also, run <code>kubectl get all --all-namespaces</code> on the master node and make sure all the pods are running properly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="networking">7. Networking</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_firewall_2">7.1. Firewall</h3>
<div class="paragraph">
<p>The firewall (firewalld) on each node is disabled by default.</p>
</div>
<div class="paragraph">
<p>If you want to enable it, set the <code>firwall_enabled</code> variable to <code>yes</code> in the <code>inventory/group_vars/all/networking.yml</code> file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
On RHEL 8 / CentOS 8, the firewall must be disabled.
If you enable it, it interferes with the <code>kube-proxy</code> nftables configuration and won&#8217;t work properly.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_metallb">7.2. MetalLB</h3>
<div class="paragraph">
<p>You can use MetalLB as an implementation of the LoadBalancer.</p>
</div>
<div class="paragraph">
<p>See <a href="https://metallb.universe.tf/">MetalLB</a> for details.
There are two operating modes for MetalLB, L2 mode and BGP mode, but this installer supports only L2 mode.</p>
</div>
<div class="paragraph">
<p>If you want to use MetalLB, you need to change the file <code>inventory/group_vars/all/networking.yml</code> file with editor and add configurations.
An example configuration is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml"># Enable MetalLB?
metallb_enabled: yes

# MetalLB IP address pool range
metallb_ip_range: 192.168.1.200-192.168.1.210</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>metallb_enabled: set to <code>yes</code></p>
</li>
<li>
<p>metallb_ip_range: IP address pool range to be used for LoadBalancer.
You must specify the free IP addresses on the subnet to which each node is connected.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="storage">8. Storage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">8.1. Overview</h3>
<div class="paragraph">
<p>When you use <a href="#ansible_installer">Chapter 6, <em>Ansible Installer</em></a>, you can use <a href="https://rook.io/">Rook</a> to set up storage.</p>
</div>
<div class="paragraph">
<p>The following two types are supported.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://rook.github.io/docs/rook/master/nfs.html">NFS</a></p>
</li>
<li>
<p><a href="https://rook.github.io/docs/rook/master/ceph-quickstart.html">Ceph Storage</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="rook_nfs">8.2. Rook / NFS</h3>
<div class="paragraph">
<p>You can use Rook + NFS (Network File System).</p>
</div>
<div class="paragraph">
<p>The NFS server is started as a pod on the Kubernetes cluster.
The NFS server uses local volume on one specific node that you specify, and the NFS server pod is configured to run on this node.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://rook.github.io/docs/rook/master/nfs.html">NFS</a> of the Rook Documentation.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This configuration uses storage on one particular node, so it has no availability.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configuration_and_deployment">8.2.1. Configuration and Deployment</h4>
<div class="paragraph">
<p>To use NFS, describe configuration in <code>inventory/group_vars/all/storage.yml</code> file.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">#----------------------------------------------------------
# rook-nfs config
#----------------------------------------------------------

# rook-nfs Enabled?
rook_nfs_enabled: yes

# Hostname hosts NFS PV local volume
rook_nfs_pv_host: "worker-1"

# NFS local volume size
#rook_nfs_pv_size: 10Gi

# NFS local volume dir on host
#rook_nfs_pv_dir: /var/lib/rook-nfs</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>rook_nfs_enabled: To enable NFS, set to <code>yes</code>.</p>
</li>
<li>
<p>rook_nfs_pv_host: The name of the node where Local Volume PV is created.</p>
<div class="ulist">
<ul>
<li>
<p>Specify one of the node names listed in Inventory file.</p>
</li>
<li>
<p>The NFS server storage is allocated on the node you specify, and the NFS server pod also runs on this node.</p>
</li>
<li>
<p>The node must be Schedulable.</p>
</li>
</ul>
</div>
</li>
<li>
<p>rook_nfs_pv_size: Size of Local Volume (storage size of the NFS server). Default is 10Gi.</p>
</li>
<li>
<p>rook_nfs_pv_dir: Specify the directory where you want to create the Local Volume. The default is <code>/var/lib/rook-nfs</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Follow the steps below to deploy.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts apps.yml --tags=rook-nfs</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_storage_class">8.2.2. Storage class</h4>
<div class="paragraph">
<p>A new storage class, <code>rook-nfs-share1</code>, has been added for this NFS server.</p>
</div>
<div class="paragraph">
<p>Here is an example of a Persistent Volume Claim (PVC) to use this storage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: rook-nfs-pv-claim
spec:
  storageClassName: rook-nfs-share1
  accessModes:
    - ReadWriteMany
  resources:
  requests:
    storage: 100Mi</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rook_ceph">8.3. Rook / Ceph</h3>
<div class="paragraph">
<p>You can use <code>Rook</code> + <code>Ceph</code>.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://rook.github.io/docs/rook/master/ceph-quickstart.html">Ceph Storage Quickstart</a> of the Rook documentation.</p>
</div>
<div class="sect3">
<h4 id="_requirements_3">8.3.1. Requirements.</h4>
<div class="paragraph">
<p>The following conditions are required.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A minimum of three worker nodes are required.</p>
</li>
<li>
<p>You must have an unformatted/unpartitioned raw block device connected to your worker nodes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://rook.github.io/docs/rook/master/" class="bare">https://rook.github.io/docs/rook/master/</a> &#8230;&#8203; ceph-prerequisites.html[Ceph Prerequisites] also See also.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://rook.github.io/docs/rook/master/ceph-prerequisites.html">Ceph Prerequisites</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_and_deployment_2">8.3.2. Configuration and Deployment</h4>
<div class="paragraph">
<p>If you use Ceph, describe the configuration in <code>inventory/group_vars/all/storage.yml</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">#----------------------------------------------------------
# rook-ceph config
#----------------------------------------------------------
rook_ceph_enabled: yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set <code>rook_ceph_enabled</code> to <code>yes</code>.</p>
</div>
<div class="paragraph">
<p>Deploy the rook-ceph as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts apps.yml --tags=rook-ceph</pre>
</div>
</div>
<div class="paragraph">
<p>Deploying Rook / Ceph takes about 10 minutes. Check the status with <code>watch kubectl -n rook-ceph get all</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_storage_class_2">8.3.3. Storage class</h4>
<div class="paragraph">
<p>The following storage classes will be added.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rook-ceph-block</code> : block storage (rbd)</p>
</li>
<li>
<p><code>rook-cephfs</code> : Filesystem (cephfs)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of a Persistent Volume Claim (PVC) to use this storage class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: rook-ceph-pv-claim
spec:
  storageClassName: rook-ceph-block
  accessModes:
    - ReadWriteOnce
  resources:
  requests:
    storage: 100Mi</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application">9. Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you use <a href="#ansible_installer">Chapter 6, <em>Ansible Installer</em></a>,  you can deploy some application automatically.</p>
</div>
<div class="sect2">
<h3 id="private_registry">9.1. Private Registry</h3>
<div class="paragraph">
<p>You can deploy a private registry.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.docker.com/registry/">Docker Registry</a> is used for private registry.</p>
</div>
<div class="paragraph">
<p>You need Persistent Volume to store container images.
If you have Rook / NFS or Rook / Ceph deployment, you can use them.</p>
</div>
<div class="sect3">
<h4 id="_configuration_and_deployment_3">9.1.1. Configuration and Deployment</h4>
<div class="paragraph">
<p>If you deploy the private registry, put the configuration in <code>inventory/group_vars/all/registry.yml</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml"># Registry enabled?
registry_enabled: yes

# Registry type: static-pod or pv
registry_type: pv

# Auth user
registry_user: registry

# Auth password
registry_password: registry

# Registry image version
#registry_version: 2.7.1

# PVC storage class name
#registry_pvc_storage_class: rook-nfs-share1  # Default to use rook-nfs
registry_pvc_storage_class: rook-ceph-block  # Use rook-ceph block storage

# PVC storage size
registry_pvc_size: 10Gi</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>registry_enabled: Enable the registry. Set to <code>yes</code>.</p>
</li>
<li>
<p>registry_type: Specify the registry type. Set to <code>pv</code>. Default is 'pv'.</p>
</li>
<li>
<p>registry_user: Specify the registry authentication user name. Change it if necessary.</p>
</li>
<li>
<p>registry_password: Specify the registry authentication password. Change it if necessary.</p>
</li>
<li>
<p>registry_pvc_storage_class: Specify the storage class of PV to be used.</p>
<div class="ulist">
<ul>
<li>
<p>If you use <a href="#rook_nfs">Rook / NFS</a>, specify <code>rook-nfs-share-1</code>.</p>
</li>
<li>
<p>If you use <a href="#rook_ceph">Rook / Ceph</a>, specify <code>rook-ceph-block</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>registry_pvc_size: Specify the size of the PV to be allocated as a registry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Follow the steps below to deploy:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts apps.yml --tags=registry</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_private_registry">9.1.2. Using private registry</h4>
<div class="paragraph">
<p>The registry is exported as a NodePort service.
To find out the port number, follow these steps:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl -n registry get svc</pre>
</div>
</div>
<div class="paragraph">
<p>The URL of the registry is <code>https://[node]:[nodeport]</code>,
where <code>node</code> is the address/host of one of the nodes, and <code>nodeport</code> is the port number of the NodePort identified above.</p>
</div>
<div class="paragraph">
<p>You can login by the following procedure.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ docker login https://[node]:[nodeport]</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="offline_install">10. Offline Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_2">10.1. Overview</h3>
<div class="paragraph">
<p>In offline installation, all the files required for the installation are obtained on a machine connected to the Internet,
and then transferred to the target machine using a USB memory or hard disk.</p>
</div>
<div class="paragraph">
<p>The procedure for offline installation is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On a machine connected to the Internet, use the script to acquire files to required to installation.</p>
<div class="ulist">
<ul>
<li>
<p>This will retrieve the RPM file of Docker/Kubeadm/Kubelet, container image files, etc.</p>
</li>
<li>
<p>The file <code>k8s-offline-files.tar.gz</code> will be generated contains which contains all these files.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Transfer this file to the target machine using some means (USB memory, hard disk, VPN, etc.).</p>
</li>
<li>
<p>Use the installer to run the installation.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_generating_an_offline_installation_file">10.2. Generating an offline installation file</h3>
<div class="paragraph">
<p>This section describes the process of generating an offline installation file.</p>
</div>
<div class="sect3">
<h4 id="_requirements_4">10.2.1. Requirements</h4>
<div class="ulist">
<ul>
<li>
<p>The machines that are connected to the Internet. The machine must have the same operating system installed as the machine comprising the Kubernetes cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following steps must be performed on the above machine.</p>
</div>
</div>
<div class="sect3">
<h4 id="_preparation">10.2.2. Preparation</h4>
<div class="paragraph">
<p>If you are using RHEL 7, you must enable the <code>rhel-7-server-extras-rpms</code> repository.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ subscription-manager repos --enable=rhel-7-server-extras-rpms</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_proxy_configuration_2">10.2.3. Proxy configuration</h4>
<div class="paragraph">
<p>If your Internet connection needs to go through a proxy server, you need to set up proxy settings beforehand.</p>
</div>
<div class="paragraph">
<p>You can add the proxy settings to <code>config.sh</code> and execute <code>sudo . /setup-proxy.sh</code> to configure following settings.</p>
</div>
<div class="sect4">
<h5 id="_yum_2">10.2.3.1. yum</h5>
<div class="paragraph">
<p>Add a line <code>proxy=http://proxy.example.com</code> in /etc/yum.conf to specify your proxy server.</p>
</div>
</div>
<div class="sect4">
<h5 id="_docker_2">10.2.3.2. Docker</h5>
<div class="paragraph">
<p>Create <code>/etc/systemd/system/docker.service.d/http-proxy.conf</code> like as following, and reboot docker.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[Service]
Environment="HTTP_PROXY=http://proxy.example.com:8080" "HTTPS_PROXY=http://proxy.example.com:8080" "NO_PROXY=localhost,127.0.0.1,..."</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generating_an_offline_installation_file_2">10.2.4. Generating an offline installation file</h4>
<div class="paragraph">
<p>Log in with user with have sudo privileges.</p>
</div>
<div class="paragraph">
<p>Follow these steps to generate an offline installation file.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sudo ./generate-offline.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Offline install file is generated as <code>k8s-offline-files.tar.gz</code> file.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_use_with_script_based_installer">10.3. Use with script based installer</h3>
<div class="paragraph">
<p>Place <code>k8s-offline-files.tar.gz</code> in the script based installer directory.</p>
</div>
<div class="paragraph">
<p>Change <code>OFFLINE_INSTALL=</code> value to <code>yes</code> in <code>config.sh</code>.
When you run the installation in this state, an offline installation will be performed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ansible_installer">10.4. Ansible installer</h3>
<div class="paragraph">
<p>Extract <code>k8s-offline-files.tar.gz</code> file in the Ansible installer directory.</p>
</div>
<div class="paragraph">
<p>Change <code>offline_install</code> variable to <code>yes</code> in <code>inventory/group_vars/all/offline.yml</code> file.
When you run the installation in this state, an offline installation will be performed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrading_cluster">11. Upgrading cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The steps to upgrade your Kubernetes cluster.</p>
</div>
<div class="sect2">
<h3 id="_notes">11.1. Notes</h3>
<div class="paragraph">
<p>You can only upgrade your Kubernetes cluster to version 0.1 at a time.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://kubernetes.io/docs/setup/release/version-skew-policy/">Kubernetes version and version skew support policy</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ansible_installer_2">11.2. Ansible installer</h3>
<div class="paragraph">
<p>If you are using the the Ansible installer, the upgrade can be done automatically.</p>
</div>
<div class="sect3">
<h4 id="_prepare_for_offline_installation">11.2.1. Prepare for offline installation</h4>
<div class="paragraph">
<p>If you are using an offline installation, you must obtain and extract the offline installation file in advance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_set_up_version">11.2.2. Set up version</h4>
<div class="paragraph">
<p>Change following variables in <code>inventory/group_vars/all/version.yml</code> file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kube_version: Version of the Kubernetes.</p>
</li>
<li>
<p>kubeadm_version, kubelet_version, kubectl_version: Versions of kubeadm, kubelet, kubectl (RPM version)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_performing_upgrades">11.2.3. Performing Upgrades</h4>
<div class="paragraph">
<p>Follow the steps below to upgrade the master nodes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts upgrade-master.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Follow the steps below to upgrade the worker nodes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts upgrade-worker.yml</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_operations">12. Operations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_renewal_of_certificates">12.1. Renewal of certificates</h3>
<div class="paragraph">
<p>Kubernetes server and client certificates are valid for one year, so you have to renew your certificates periodically.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-certs/">Certificate Management with kubeadm</a>.</p>
</div>
<div class="sect3">
<h4 id="_automatic_renewal_of_certificates">12.1.1. Automatic renewal of certificates</h4>
<div class="paragraph">
<p>When you upgrade Kubernetes, kubeadm will automatically update your certificates.
Kubernetes gets a minor upgrade every few months, so if you upgrade regularly in conjunction with this, your certificate will not expire.
(It is a best practice to upgrade your cluster frequently in order to stay secure.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_verification_of_certificate_expiration_date">12.1.2. Verification of Certificate Expiration Date</h4>
<div class="paragraph">
<p>You can check the expiration date by performing the following procedure on each master node.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sudo kubeadm alpha certs check-expiration</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manual_certificate_update">12.1.3. Manual certificate update</h4>
<div class="paragraph">
<p>You can manually update your certificate by following the steps below.</p>
</div>
<div class="sect4">
<h5 id="_if_you_are_using_the_ansible_installer">12.1.3.1. If you are using the Ansible installer</h5>
<div class="paragraph">
<p>You can use the <code>renew-server-certs</code> playbook to manually update the certificates on all master nodes.
All certificates are regenerated with an expiration date of one year.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i inventory/hosts renew-server-certs.yml</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_if_you_are_using_the_script_based_installer">12.1.3.2. If you are using the script based installer</h5>
<div class="paragraph">
<p>Perform the following procedures on all master nodes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sudo kubeadm alpha certs renew all
$ sudo /bin/rm /var/lib/kubelet/kubelet.crt
$ sudo /bin/rm /var/lib/kubelet/kubelet.key
$ sudo systemctl restart kubelet</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-07-13 22:26:25 +0900
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
</body>
</html>